<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="adminCode">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>

	<!-- 코드 서브 목록 조회 -->
	<select id="codeDAO.selectSubCodeList" parameterClass="java.util.HashMap" resultClass="egovMap">
		/* QUERY ID : codeDAO.selectSubCodeList */
		SELECT * FROM TB_CM_CT_DETAILCODE
		 WHERE 1=1
		   AND CODE_CD = #codeid#
		 ORDER BY CODE_DETL_CD
	</select>

	<!-- 임시운행 목록 조회 -->
	<select id="codeDAO.selectTempOperList" parameterClass="java.util.HashMap" resultClass="egovMap">
		/* QUERY ID : codeDAO.selectTempOperList */
		SELECT E.TMP_RACE_NUMBER   AS TMP_NUMBER
		      ,E.TMP_RACE_AGENCY   AS TMP_AGENCY
		      ,E.INS_LETTER_NUMBER AS LETTER_NUM
		      ,DATE_FORMAT(E.INS_INIT_DATE, '%Y%m%d%H%i') AS INS_INIT_DATE
		      ,DATE_FORMAT(E.INS_INIT_DATE, '%Y-%m-%d') AS INS_INIT_DATE_VIEW
		  FROM TB_CM_HT_TEMPOPER E
		 WHERE 1=1
			<isNotEmpty prepend="AND" property="userid">  
		   E.USER_ID = #userid# 
			</isNotEmpty> 
		   AND E.APPOR_STATUS = '102'
		 ORDER BY E.TMP_RACE_NUMBER DESC
	</select>
	
	<!-- 임시운행 정보 조회 -->
	<select id="codeDAO.selectTempOperInfo" parameterClass="java.util.HashMap" resultClass="egovMap">
		/* QUERY ID : codeDAO.selectTempOperInfo */
		SELECT E.TMP_RACE_NUMBER   AS TMP_NUMBER
		      ,E.TMP_RACE_AGENCY   AS TMP_AGENCY
		      ,E.INS_LETTER_NUMBER AS LETTER_NUM
		      ,DATE_FORMAT(E.INS_INIT_DATE, '%Y%m%d%H%i') AS INS_INIT_DATE
		      ,DATE_FORMAT(E.INS_INIT_DATE, '%Y-%m-%d %H:%i') AS INS_INIT_DATE_VIEW
		  FROM TB_CM_HT_TEMPOPER E
		 WHERE E.TMP_RACE_NUMBER = #tmp_race_number# 
		   AND E.APPOR_STATUS = '102'
	</select>	

	<!-- 임시운행기관명 -->
	<select id="codeDAO.selectTmpAgency" parameterClass="java.util.HashMap" resultClass="String">
		/* QUERY ID : codeDAO.selectTmpAgency */
		SELECT DISTINCT E.TMP_RACE_AGENCY
		  FROM TB_CM_HT_TEMPOPER E
		 WHERE E.TMP_RACE_NUMBER = #tmp_race_number#
	</select>

	<!-- 임시운행정보 중복확인 -->
	<select id="codeDAO.selectTmpNoIsExist" parameterClass="java.util.HashMap" resultClass="int">
		/* QUERY ID : codeDAO.selectTmpNoIsExist */
		SELECT COUNT(*) selcnt
		  FROM TB_CM_HT_TEMPOPER E
		 WHERE 1=1
		   AND E.TMP_RACE_NUMBER = #tmp_race_number#
	</select>

	<!-- 임시운행정보 등록 -->
	<insert id="codeDAO.insertTempOper" parameterClass="java.util.HashMap">
		/* QUERY ID : codeDAO.insertTempOper */
		INSERT 
		  INTO TB_CM_HT_TEMPOPER 
		       (TMP_RACE_NUMBER
		       ,TMP_RACE_AGENCY
		       ,INS_LETTER_NUMBER
		       ,INS_INIT_DATE
		       ,USER_ID
		       ,APPOR_STATUS
		       ,DEED_FILENAME
		       ,PERMIT_DATE
		       ,CAR_MODEL
		       ,POWER_SOURCE
		       ,REG_ID
		       ,REG_DATE)
		VALUES (#tmp_race_number#
		       ,#tmp_race_agency#
		       ,#ins_letter_number#
		       ,STR_TO_DATE(#ins_init_date#,'%Y-%m-%d %H:%i:%s')
		       ,#user_id#
		       ,#appor_status#
		       ,#deed_filename#
		       ,NOW()
		       ,#car_model#
		       ,#power_source#
		       ,#user_id#
		       ,NOW())
	</insert>
	
	<!-- 임시운행정보 보험가입일자 수정 -->
	<update id="codeDAO.updateTempOperInsdate" parameterClass="java.util.HashMap">
		/* QUERY ID : codeDAO.updateTempOperInsdate */
		UPDATE TB_CM_HT_TEMPOPER
		SET INS_INIT_DATE = STR_TO_DATE(#ins_init_date#,'%Y-%m-%d %H:%i:%s')
		WHERE TMP_RACE_NUMBER = #tmp_race_number#
	</update>

	<!-- 게시판 그룹 목록 조회 -->
	<select id="codeDAO.selectBbsGroupList" parameterClass="java.util.HashMap" resultClass="egovMap">
		/* QUERY ID : codeDAO.selectBbsGroupList */
		SELECT A.*
		  FROM TB_WEB_HT_BBSGROUP A
		 WHERE 1=1
		   AND A.USE_YN = 'Y'
		 ORDER BY A.BBS_GROUP_SEQ
	</select>

	<!-- 게시판 목록 조회 -->
	<select id="codeDAO.selectBbsList" parameterClass="java.util.HashMap" resultClass="egovMap">
		/* QUERY ID : codeDAO.selectBbsList */
		SELECT A.*
		      ,fn_ct_get_code_name('bbs_mode', A.BBS_MODE ) AS BBS_MODE_VIEW
		  FROM TB_WEB_HT_BBS A
		 WHERE 1=1
			<isNotEmpty prepend="AND" property="bbs_group_seq">
				A.BBS_GROUP_SEQ = #bbs_group_seq#
			</isNotEmpty>
		   AND A.USE_YN = 'Y'
		 ORDER BY A.BBS_SEQ
	</select>

	<!-- 차량 목록 조회 -->
	<select id="codeDAO.selectCarList" parameterClass="java.util.HashMap" resultClass="egovMap">
		/* QUERY ID : codeDAO.selectCarList */
		SELECT A.*
		      ,fn_ct_get_code_name('car_type', A.CAR_TYPE ) AS CAR_TYPE_VIEW 
		      ,fn_ct_get_code_name('autocar_level', A.AUTOCAR_LEVEL ) AS AUTOCAR_LEVEL_VIEW 
		  FROM TB_WEB_HT_CAR A
		 WHERE 1=1
		   AND A.USER_ID = #user_id#
		 ORDER BY A.VEHICLE_ID
	</select>

	<!-- 게시판 목록 리스트-셀렉트박스 -->
	<select id="codeDAO.selectBbsSeqList" parameterClass="java.util.HashMap" resultClass="egovMap">
		/* QUERY ID : codeDAO.selectBbsSeqList */
		SELECT A.BBS_SEQ
		      ,(CONCAT(IFNULL(B.GROUP_NM, '') , '-' , IFNULL(A.BBS_NM, ''))) AS BBS_NM
		  FROM TB_WEB_HT_BBS A, TB_WEB_HT_BBSGROUP B
		 WHERE 1=1
		   AND A.BBS_GROUP_SEQ = B.BBS_GROUP_SEQ
		   AND A.USE_YN = 'Y'
		 ORDER BY A.BBS_SEQ
	</select>

	<!-- 임시운행정보 보험등록일자 이력 등록 -->
	<insert id="codeDAO.insertTempOperInsdateHis" parameterClass="java.util.HashMap">
		/* QUERY ID : codeDAO.insertTempOperInsdateHis */
		INSERT 
		  INTO TB_CM_HT_TEMPOPER_INSDATE_HIS 
		       (TMP_RACE_NUMBER
		       ,SEQ
		       ,INS_INIT_DATE
		       ,REG_ID
		       ,REG_DATE)
		VALUES (#tmp_race_number#
			   ,(SELECT IFNULL(MAX(SEQ), 0) + 1 FROM TB_CM_HT_TEMPOPER_INSDATE_HIS AB WHERE AB.TMP_RACE_NUMBER = #tmp_race_number#)
		       ,STR_TO_DATE(#ins_init_date#,'%Y-%m-%d %H:%i:%s')
		       ,#user_id#
		       ,NOW())
	</insert>
	
	<!-- 임시운행정보 보험등록일자 이력 조회 -->
	<select id="codeDAO.selectTempOperInsdateHisList" parameterClass="java.util.HashMap" resultClass="egovMap">
		/* QUERY ID : codeDAO.selectTempOperInsdateHisList */
		SELECT E.TMP_RACE_NUMBER   AS TMP_NUMBER
		      ,E.SEQ AS SEQ
		      ,DATE_FORMAT(E.INS_INIT_DATE, '%Y%m%d%H%i%s') AS INS_INIT_DATE
		      ,DATE_FORMAT(E.INS_INIT_DATE, '%Y-%m-%d %H:%i') AS INS_INIT_DATE_VIEW
		      ,DATE_FORMAT(E.INS_INIT_DATE,'%Y-%m-%d') AS INS_INIT_DATE_VIEW
		      ,E.REG_ID
		      ,E.REG_DATE
   		      ,DATE_FORMAT(E.REG_DATE, '%Y-%m-%d %H:%i') AS REG_DATE
		      ,E.UPDATE_ID
   		      ,DATE_FORMAT(E.UPDATE_DATE, '%Y-%m-%d %H:%i') AS UPDATE_DATE
		  FROM TB_CM_HT_TEMPOPER_INSDATE_HIS E		      
		 WHERE E.TMP_RACE_NUMBER = #tmp_race_number#
		 ORDER BY E.SEQ DESC
	</select>	
	
	<!-- 제어권전환사유코드 목록 조회 -->
	<select id="codeDAO.selectCtrChangeCodeList" parameterClass="java.util.HashMap" resultClass="egovMap">
		/* QUERY ID : codeDAO.selectCtrChangeCodeList */
		  SELECT CTR_CHANGE_CODE
		        ,CTR_CHANGE_NM
		        ,CTR_CHANGE_DESC
		  FROM TB_CL_HT_CTRCHANGE_CODE
		  WHERE USE_YN = 'Y'
		  ORDER BY CTR_CHANGE_CODE ASC
	</select>		
	
	<!-- 차량관리 목록 조회 -->
	<select id="codeDAO.selectTempCareList" parameterClass="java.util.HashMap" resultClass="egovMap">
		/* QUERY ID : codeDAO.selectTempCareList */
		SELECT *
		  FROM (
		  	SELECT E.TMP_RACE_NUMBER   AS TMP_NUMBER
		      ,E.TMP_RACE_AGENCY   AS TMP_AGENCY
		      ,E.INS_LETTER_NUMBER AS LETTER_NUM
		      ,DATE_FORMAT(E.INS_INIT_DATE, '%Y%m%d%H%i') AS INS_INIT_DATE
		      ,DATE_FORMAT(E.INS_INIT_DATE, '%Y-%m-%d') AS INS_INIT_DATE_VIEW
		      ,E.APPOR_STATUS
		      ,CEIL( ROW_NUMBER() OVER (ORDER BY E.TMP_RACE_NUMBER DESC) / 10 ) LISTCNT
		  FROM TB_CM_HT_TEMPOPER E
		 WHERE 1=1
			<isNotEmpty prepend="AND" property="userid">  
		   E.USER_ID = #userid# 
			</isNotEmpty> 
			)AB
		 WHERE LISTCNT = #iPageNo#
		 ORDER BY AB.TMP_NUMBER 
	</select>
	
	<!-- 차량관리 목록 총 개수 -->
	<select id="codeDAO.selectTempCareListTotCnt" parameterClass="java.util.HashMap" resultClass="int">
		/* QUERY ID : codeDAO.selectTempCareListTotCnt */
		SELECT COUNT(*) totcnt
		  FROM TB_CM_HT_TEMPOPER
		 WHERE 1=1
			<isNotEmpty prepend="AND" property="userid">  
		   USER_ID = #userid# 
			</isNotEmpty> 
	</select>
	
	<!-- 엣지케이스 시나리오 서브코드  목록 조회 -->
	<select id="codeDAO.selectSubCodeChkList" parameterClass="java.util.HashMap" resultClass="egovMap">
		/* QUERY ID : codeDAO.selectSubCodeChkList */
		SELECT * FROM TB_CM_CT_DETAILCODE
		 WHERE 1=1
		   AND REF_VAL2 = #searchScenarioCode1#
		 ORDER BY CODE_DETL_CD
	</select>
	
	<!-- 엣지케이스 시나리오 서드코드  목록 조회 -->
	<select id="codeDAO.selectSubCodeChkList2" parameterClass="java.util.HashMap" resultClass="egovMap">
		/* QUERY ID : codeDAO.selectSubCodeChkList2 */
		SELECT * FROM TB_CM_CT_DETAILCODE
		 WHERE 1=1
		   AND REF_VAL2 = #searchScenarioCode2#
		 ORDER BY CODE_DETL_CD
	</select>
	
	<!--임시운행기관 리스트 조회 -->
	<select id="codeDAO.selectDutyList" parameterClass="java.util.HashMap" resultClass="egovMap">
		/* QUERY ID : codeDAO.selectDutyList */
		SELECT AGENCY_CD FROM TB_WEB_IT_USER 
		WHERE USE_YN= 'Y'
		OR APPOR_STATUS ='102' 
		GROUP BY AGENCY_CD 
	</select>
</sqlMap>
